name: permits_validation
version: 1.0.0
description: "Great Expectations suite for permit data validation"

datasources:
  - name: pandas
    class_name: PandasDatasource
    data_asset_type:
      class_name: PandasDataset

expectation_suite_name: permits_suite

meta:
  created_by: HousingModel ETL
  dataset_type: permits
  validation_level: strict

expectations:
  - expectation_type: expect_table_row_count_to_be_between
    kwargs:
      min_value: 10
      max_value: 50000
    meta:
      description: "Permit datasets should have reasonable row counts"

  - expectation_type: expect_table_columns_to_match_ordered_list
    kwargs:
      column_list:
        - permit_id
        - permit_type
        - status
        - description
        - application_date
        - issue_date
        - expiration_date
        - estimated_cost
        - actual_cost
        - valuation
        - property_type
        - applicant_name
        - contractor_name
        - source_system
        - collected_at
    meta:
      description: "Required columns for permit data"

  - expectation_type: expect_column_to_exist
    kwargs:
      column: permit_id
    meta:
      description: "Permit ID column must exist"

  - expectation_type: expect_column_to_exist
    kwargs:
      column: permit_type
    meta:
      description: "Permit type column must exist"

  - expectation_type: expect_column_to_exist
    kwargs:
      column: status
    meta:
      description: "Status column must exist"

  - expectation_type: expect_column_to_exist
    kwargs:
      column: application_date
    meta:
      description: "Application date column must exist"

  - expectation_type: expect_column_values_to_not_be_null
    kwargs:
      column: permit_id
    meta:
      description: "Permit IDs cannot be null"

  - expectation_type: expect_column_values_to_not_be_null
    kwargs:
      column: permit_type
    meta:
      description: "Permit types cannot be null"

  - expectation_type: expect_column_values_to_not_be_null
    kwargs:
      column: status
    meta:
      description: "Status values cannot be null"

  - expectation_type: expect_column_values_to_not_be_null
    kwargs:
      column: application_date
    meta:
      description: "Application dates cannot be null"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: permit_id
      type_: STRING
    meta:
      description: "Permit ID must be string"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: permit_type
      type_: STRING
    meta:
      description: "Permit type must be string"

  - expectation_type: expect_column_values_to_be_in_set
    kwargs:
      column: permit_type
      value_set:
        - residential_new
        - residential_renovation
        - commercial_new
        - commercial_renovation
        - demolition
        - addition
        - pool
        - garage
        - deck
        - fence
        - other
    meta:
      description: "Permit type must be valid enum value"

  - expectation_type: expect_column_values_to_be_in_set
    kwargs:
      column: status
      value_set:
        - pending
        - approved
        - denied
        - under_review
        - issued
        - expired
        - cancelled
        - completed
    meta:
      description: "Status must be valid enum value"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: application_date
      type_: DATE
    meta:
      description: "Application date must be date type"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: issue_date
      type_: DATE
    meta:
      description: "Issue date must be date type (if present)"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: estimated_cost
      type_: FLOAT
    meta:
      description: "Estimated cost must be numeric (if present)"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: actual_cost
      type_: FLOAT
    meta:
      description: "Actual cost must be numeric (if present)"

  - expectation_type: expect_column_values_to_be_between
    kwargs:
      column: estimated_cost
      min_value: 0
      max_value: 100000000
    meta:
      description: "Estimated cost should be between $0 and $100M"

  - expectation_type: expect_column_values_to_be_between
    kwargs:
      column: actual_cost
      min_value: 0
      max_value: 100000000
    meta:
      description: "Actual cost should be between $0 and $100M"

  - expectation_type: expect_column_values_to_not_be_null
    kwargs:
      column: source_system
    meta:
      description: "Source system must be specified"

  - expectation_type: expect_column_values_to_be_in_set
    kwargs:
      column: source_system
      value_set:
        - nyc_dob_api
        - la_building_safety_api
        - chicago_permits_api
        - generic_permit_portal
    meta:
      description: "Source system must be valid permit source"

  - expectation_type: expect_column_values_to_not_be_null
    kwargs:
      column: collected_at
    meta:
      description: "Collection timestamp must be present"

  - expectation_type: expect_column_values_to_be_of_type
    kwargs:
      column: collected_at
      type_: TIMESTAMP
    meta:
      description: "Collection timestamp must be timestamp type"

  - expectation_type: expect_column_proportion_of_unique_values_to_be_between
    kwargs:
      column: permit_id
      min_value: 0.95
      max_value: 1.0
    meta:
      description: "Permit IDs should be mostly unique (95-100%)"

  - expectation_type: expect_column_pair_values_to_be_equal
    kwargs:
      column_A: application_date
      column_B: application_date
      ignore_row_if: never
    meta:
      description: "Application date consistency check (placeholder for cross-table validation)"

  - expectation_type: expect_column_values_to_be_between
    kwargs:
      column: application_date
      min_value: 2010-01-01
      max_value: 2030-12-31
    meta:
      description: "Application dates should be between 2010 and 2030"
